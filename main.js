!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_disabled",inputErrorClass:"modal__input_type_error"},t=(e,t,n)=>{t.validity.valid?o(e,t,n):r(e,t,t.validationMessage,n)},r=(e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)},o=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},n=(e,t,r)=>{l(e)?a(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},a=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},l=e=>e.some((e=>!e.validity.valid));let c,d;const i=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._fetch("/cards")}getUserInfo(){return this._fetch("/users/me")}editUserInfo(e){let{name:t,about:r}=e;return this._fetch("/users/me","PATCH",JSON.stringify({name:t,about:r}))}editUserAvatar(e){return this._fetch("/users/me/avatar","PATCH",JSON.stringify({avatar:e}))}addCard(e){let{name:t,link:r}=e;return this._fetch("/cards","POST",JSON.stringify({name:t,link:r}))}deleteCard(e){return this._fetch(`/cards/${e}`,"DELETE")}changeLike(e,t){return this._fetch(`/cards/${t}/likes`,e?"DELETE":"PUT")}_fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0;return fetch(this._baseUrl+e,{method:t,headers:this._headers,body:r}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"6f5c355c-ba63-4c32-a72d-75121ae25533","Content-Type":"application/json"}});i.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{u.append(N(e))})),v.textContent=r.name,y.textContent=r.about,f.src=r.avatar})).catch(console.error);const s=document.querySelector("#card-template").content,u=document.querySelector(".cards__list"),m=document.querySelector("#edit-profile-modal"),_=document.querySelector(".profile__edit-button"),v=(m.querySelector(".modal__exit-button"),document.querySelector(".profile__name")),y=document.querySelector(".profile__description"),f=document.querySelector(".profile__avatar"),h=document.forms["profile-form"],S=h.querySelector("#input-name"),p=h.querySelector("#input-description"),q=document.querySelector("#add-card-modal"),b=document.querySelector(".profile__add-button"),E=(q.querySelector(".modal__exit-button"),q.querySelector(".modal__save-button")),k=document.forms["add-card-form"],L=k.querySelector("#add-card-input-link"),C=k.querySelector("#add-card-input-name"),g=document.querySelector("#preview-modal"),x=(g.querySelector(".modal__exit-button"),g.querySelector(".modal__image")),A=g.querySelector(".modal__caption"),U=document.querySelector(".profile__avatar-button"),I=document.querySelector("#avatar-modal"),T=(I.querySelector(".modal__exit-button"),document.forms["avatar-form"]),P=T.querySelector("#avatar-input-link"),B=document.querySelector("#delete-modal"),D=document.forms["delete-form"];function $(e){e.classList.add("modal_opened"),document.addEventListener("keydown",O)}function w(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",O)}function N(e){const t=s.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image");r.textContent=e.name,o.src=e.link,o.alt=e.name;const n=t.querySelector(".card__like-button");return e.isLiked&&n.classList.add("card__like-button_liked"),n.addEventListener("click",(t=>{i.changeLike(n.classList.contains("card__like-button_liked"),e._id).then((()=>{n.classList.toggle("card__like-button_liked")})).catch(console.error)})),t.querySelector(".card__delete-button").addEventListener("click",(r=>{$(B),c=t,d=e._id})),o.addEventListener("click",(t=>{$(g),x.src=e.link,x.alt=e.name,A.textContent=e.name})),t}B.querySelector(".modal__exit-button"),B.querySelector("#cancel-button"),B.querySelector("#delete-button"),document.querySelectorAll(".modal__close").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>w(t)))})),D.addEventListener("submit",(e=>{j(e,(()=>i.deleteCard(d).then((e=>{w(B),c.remove()}))),"Delete","Deleting...")})),U.addEventListener("click",(()=>{$(I)})),T.addEventListener("submit",(t=>{j(t,(()=>i.editUserAvatar(P.value).then((r=>{f.src=r.avatar,w(I),a(t.submitter,e)}))))})),_.addEventListener("click",(()=>{var t,r;$(m),S.value=v.textContent,p.value=y.textContent,t=h,r=e,[S,p].forEach((e=>{o(t,e,r)}))})),h.addEventListener("submit",(e=>{j(e,(()=>i.editUserInfo({name:S.value,about:p.value}).then((e=>{v.textContent=e.name,y.textContent=e.about,w(m)}))))})),b.addEventListener("click",(()=>{$(q)})),k.addEventListener("submit",(t=>{j(t,(()=>i.addCard({link:L.value,name:C.value}).then((t=>{w(q),u.prepend(N(t)),a(E,e)}))))})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal")&&w(e.target)}))}));const O=e=>{"Escape"===e.key&&w(document.querySelector(".modal_opened"))};function j(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.preventDefault();const n=e.submitter;n.textContent=o,t().then((()=>{e.target.reset()})).catch(console.error).finally((()=>{n.textContent=r}))}var J;J=e,document.querySelectorAll(J.formSelector).forEach((e=>{((e,r)=>{const o=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);n(o,a,r),o.forEach((l=>{l.addEventListener("input",(()=>{t(e,l,r),n(o,a,r)}))}))})(e,J)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FDdEMsTUFBTWMsRUFBWStILE1BQU1DLEtBQ3RCaEosRUFBWTBILGlCQUFpQnhILEVBQU9QLGdCQUVoQ3NCLEVBQWdCakIsRUFBWVMsY0FBY1AsRUFBT04sc0JBQ3ZEbUIsRUFBa0JDLEVBQVdDLEVBQWVmLEdBRTVDYyxFQUFVc0QsU0FBU3JFLElBQ2pCQSxFQUFhMkcsaUJBQWlCLFNBQVMsS0FDckM3RyxFQUFtQkMsRUFBYUMsRUFBY0MsR0FDOUNhLEVBQWtCQyxFQUFXQyxFQUFlZixFQUFPLEdBQ25ELEdBQ0YsRUFoQkE0SSxDQUFrQjlJLEVBQWFFLEVBQU8sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGNvbmZpZ1NldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAvLyBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKVxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gIGVsc2VcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgY29uZmlnXG4gICAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApLnRleHRDb250ZW50ID1cbiAgICBlcnJvck1lc3NhZ2U7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCkudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoZWxlbWVudCkgPT4gIWVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xufTtcbiIsImltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIGNvbmZpZ1NldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNmY1YzM1NWMtYmE2My00YzMyLWE3MmQtNzUxMjFhZTI1NTMzXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlckluZm9dKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZERhdGEpID0+IHtcbiAgICAgIGNhcmRMaXN0LmFwcGVuZChnZXRDYXJkRWxlbWVudChjYXJkRGF0YSkpO1xuICAgIH0pO1xuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICBwcm9maWxlRGVzYy50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICAgIHByb2ZpbGVJbWFnZS5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQ7XG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vIGVkaXQgcHJvZmlsZSBlbGVtZW50c1xuY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlRXhpdEJ1dHRvbiA9IHByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wicHJvZmlsZS1mb3JtXCJdO1xuY29uc3QgcHJvZmlsTmFtZUlucHV0ID0gcHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIiNpbnB1dC1uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NJbnB1dCA9IHByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXQtZGVzY3JpcHRpb25cIik7XG5cbi8vIGFkZCBjYXJkIGVsZW1lbnRzXG5jb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xuY29uc3QgYWRkQ2FyZE9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkRXhpdEJ1dHRvbiA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGFkZENhcmRTdWJtaXRCdXR0b24gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiYWRkLWNhcmQtZm9ybVwiXTtcbmNvbnN0IGFkZENhcmRGb3JtTGluayA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtaW5wdXQtbGlua1wiKTtcbmNvbnN0IGFkZENhcmRGb3JtTmFtZSA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtaW5wdXQtbmFtZVwiKTtcblxuLy8gaW1hZ2UgcHJldmlldyBlbGVtZW50c1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0V4aXRCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZXhpdC1idXR0b25cIik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBhdmF0YXIgZWxlbWVudHNcbmNvbnN0IGF2YXRhck9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyQ2xvc2VCdXR0b24gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImF2YXRhci1mb3JtXCJdO1xuY29uc3QgYXZhdGFyRm9ybUxpbmsgPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWlucHV0LWxpbmtcIik7XG5cbi8vIGRlbGV0ZSBlbGVtZW50c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImRlbGV0ZS1mb3JtXCJdO1xuY29uc3QgZGVsZXRlQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNhbmNlbEJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FuY2VsLWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNvbmZpcm1CdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1idXR0b25cIik7XG5cbi8vIGNsb3NlIGJ1dHRvbiBhc3NpZ25tZW50XG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZVwiKTtcbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgY29uc3QgcG9wdXAgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKHBvcHVwKSk7XG59KTtcblxuLy8gZGVsZXRlIGV2ZW50c1xuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgaGFuZGxlRm9ybVN1Ym1pdChcbiAgICBldnQsXG4gICAgKCkgPT4ge1xuICAgICAgcmV0dXJuIGFwaS5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgXCJEZWxldGVcIixcbiAgICBcIkRlbGV0aW5nLi4uXCJcbiAgKTtcbn0pO1xuXG4vLyBhdmF0YXIgZXZlbnRzXG5hdmF0YXJPcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZUZvcm1TdWJtaXQoZXZ0LCAoKSA9PiB7XG4gICAgcmV0dXJuIGFwaS5lZGl0VXNlckF2YXRhcihhdmF0YXJGb3JtTGluay52YWx1ZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUltYWdlLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGV2dC5zdWJtaXR0ZXIsIGNvbmZpZ1NldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuLy8gZWRpdCBwcm9maWxlIGV2ZW50c1xucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKHByb2ZpbGVNb2RhbCk7XG4gIHByb2ZpbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICBwcm9maWxlRGVzY0lucHV0LnZhbHVlID0gcHJvZmlsZURlc2MudGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBwcm9maWxlRm9ybSxcbiAgICBbcHJvZmlsTmFtZUlucHV0LCBwcm9maWxlRGVzY0lucHV0XSxcbiAgICBjb25maWdTZXR0aW5nc1xuICApO1xufSk7XG5wcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgaGFuZGxlRm9ybVN1Ym1pdChldnQsICgpID0+IHtcbiAgICByZXR1cm4gYXBpXG4gICAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgICAgbmFtZTogcHJvZmlsTmFtZUlucHV0LnZhbHVlLFxuICAgICAgICBhYm91dDogcHJvZmlsZURlc2NJbnB1dC52YWx1ZSxcbiAgICAgIH0pXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgICAgcHJvZmlsZURlc2MudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgICBjbG9zZU1vZGFsKHByb2ZpbGVNb2RhbCk7XG4gICAgICB9KTtcbiAgfSk7XG59KTtcblxuLy8gYWRkIGNhcmQgZXZlbnRzXG5hZGRDYXJkT3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbn0pO1xuYWRkQ2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZUZvcm1TdWJtaXQoZXZ0LCAoKSA9PiB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmFkZENhcmQoeyBsaW5rOiBhZGRDYXJkRm9ybUxpbmsudmFsdWUsIG5hbWU6IGFkZENhcmRGb3JtTmFtZS52YWx1ZSB9KVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICBjbG9zZU1vZGFsKGFkZENhcmRNb2RhbCk7XG4gICAgICAgIGNhcmRMaXN0LnByZXBlbmQoZ2V0Q2FyZEVsZW1lbnQocmVzKSk7XG4gICAgICAgIGRpc2FibGVCdXR0b24oYWRkQ2FyZFN1Ym1pdEJ1dHRvbiwgY29uZmlnU2V0dGluZ3MpO1xuICAgICAgfSk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBtb2RhbEVzY2FwZUxpc3RlbmVyKTtcbn1cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgbW9kYWxFc2NhcGVMaXN0ZW5lcik7XG59XG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSkge1xuICAvLyBDcmVhdGUgQ2FyZCBGcm9tIFRlbXBsYXRlXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgLy8gR2V0IGNhcmQgZWxlbWVudHNcbiAgY29uc3QgY2FyZFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcblxuICAvLyBBc3NpZ24gY2FyZCBkYXRhXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG4gIGNhcmRJbWFnZS5zcmMgPSBjYXJkRGF0YS5saW5rO1xuICBjYXJkSW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcblxuICAvLyBTZXR1cCBidXR0b25zXG4gIGNvbnN0IGxpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBpZiAoY2FyZERhdGEuaXNMaWtlZCkgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XG4gIGxpa2VCdXR0b24gLy8gbGlrZSBidXR0b25cbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGFwaVxuICAgICAgICAuY2hhbmdlTGlrZShcbiAgICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpLFxuICAgICAgICAgIGNhcmREYXRhLl9pZFxuICAgICAgICApXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgIH0pO1xuICBjYXJkRWxlbWVudCAvLyBkZWxldGUgYnV0dG9uXG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICAgIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkRGF0YS5faWQ7XG4gICAgfSk7XG4gIGNhcmRJbWFnZSAvLyBwcmVpdmV3IGltYWdlXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgICAgIHByZXZpZXdJbWFnZS5zcmMgPSBjYXJkRGF0YS5saW5rO1xuICAgICAgcHJldmlld0ltYWdlLmFsdCA9IGNhcmREYXRhLm5hbWU7XG4gICAgICBwcmV2aWV3Q2FwdGlvbi50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG4gICAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICAgIGNsb3NlTW9kYWwoZXZ0LnRhcmdldCk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG5jb25zdCBtb2RhbEVzY2FwZUxpc3RlbmVyID0gKGV2dCkgPT4ge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNsb3NlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIikpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBoYW5kbGVGb3JtU3VibWl0KFxuICBldnQsXG4gIHN1Ym1pdENhbGxiYWNrLFxuICBkZWZ1YWx0VGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0VGV4dCA9IGV2dC5zdWJtaXR0ZXI7XG4gIHN1Ym1pdFRleHQudGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgc3VibWl0Q2FsbGJhY2soKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHN1Ym1pdFRleHQudGV4dENvbnRlbnQgPSBkZWZ1YWx0VGV4dDtcbiAgICB9KTtcbn1cblxuZW5hYmxlVmFsaWRhdGlvbihjb25maWdTZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLl9mZXRjaChgL2NhcmRzYCk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5fZmV0Y2goYC91c2Vycy9tZWApO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiB0aGlzLl9mZXRjaChcbiAgICAgIGAvdXNlcnMvbWVgLFxuICAgICAgXCJQQVRDSFwiLFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICBlZGl0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gdGhpcy5fZmV0Y2goXG4gICAgICBgL3VzZXJzL21lL2F2YXRhcmAsXG4gICAgICBcIlBBVENIXCIsXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZldGNoKFxuICAgICAgYC9jYXJkc2AsXG4gICAgICBcIlBPU1RcIixcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9mZXRjaChgL2NhcmRzLyR7Y2FyZElkfWAsIFwiREVMRVRFXCIpO1xuICB9XG4gIGNoYW5nZUxpa2UoaXNMaWtlZCwgY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZldGNoKGAvY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwgaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiKTtcbiAgfVxuXG4gIF9mZXRjaChlbmRwb2ludCwgbWV0aG9kID0gXCJHRVRcIiwgYm9keSkge1xuICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IGJvZHksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIGVsc2UgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJjb25maWdTZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsInZhbGlkaXR5IiwidmFsaWQiLCJoaWRlSW5wdXRFcnJvciIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvck1lc3NhZ2UiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsInNvbWUiLCJlbGVtZW50Iiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsIl9mZXRjaCIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiYWRkQ2FyZCIsIl9yZWYzIiwibGluayIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJjaGFuZ2VMaWtlIiwiaXNMaWtlZCIsImVuZHBvaW50IiwibWV0aG9kIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiYm9keSIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImF1dGhvcml6YXRpb24iLCJjYXJkcyIsInVzZXJJbmZvIiwiZm9yRWFjaCIsImNhcmREYXRhIiwiY2FyZExpc3QiLCJhcHBlbmQiLCJnZXRDYXJkRWxlbWVudCIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2MiLCJwcm9maWxlSW1hZ2UiLCJzcmMiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImNhcmRUZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsInByb2ZpbGVNb2RhbCIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbE5hbWVJbnB1dCIsInByb2ZpbGVEZXNjSW5wdXQiLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkT3BlbkJ1dHRvbiIsImFkZENhcmRTdWJtaXRCdXR0b24iLCJhZGRDYXJkRm9ybSIsImFkZENhcmRGb3JtTGluayIsImFkZENhcmRGb3JtTmFtZSIsInByZXZpZXdNb2RhbCIsInByZXZpZXdJbWFnZSIsInByZXZpZXdDYXB0aW9uIiwiYXZhdGFyT3BlbkJ1dHRvbiIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhckZvcm1MaW5rIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwib3Blbk1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwibW9kYWxFc2NhcGVMaXN0ZW5lciIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGUiLCJjYXJkSW1hZ2UiLCJhbHQiLCJsaWtlQnV0dG9uIiwiZXZ0IiwiY29udGFpbnMiLCJfaWQiLCJ0b2dnbGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwicG9wdXAiLCJjbG9zZXN0IiwiaGFuZGxlRm9ybVN1Ym1pdCIsInZhbHVlIiwiZGF0YSIsInN1Ym1pdHRlciIsInJlc2V0VmFsaWRhdGlvbiIsImlucHV0IiwicHJlcGVuZCIsInRhcmdldCIsImtleSIsInN1Ym1pdENhbGxiYWNrIiwiZGVmdWFsdFRleHQiLCJsb2FkaW5nVGV4dCIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0VGV4dCIsInJlc2V0IiwiZmluYWxseSIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIl0sInNvdXJjZVJvb3QiOiIifQ==