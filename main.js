!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_disabled",inputErrorClass:"modal__input_type_error"},t=(e,t,n)=>{t.validity.valid?o(e,t,n):r(e,t,t.validationMessage,n)},r=(e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)},o=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},n=(e,t,r)=>{c(e)?a(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},a=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},c=e=>e.some((e=>!e.validity.valid));let l,d;const i=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._fetch("/cards")}getUserInfo(){return this._fetch("/users/me")}editUserInfo(e){let{name:t,about:r}=e;return this._fetch("/users/me","PATCH",JSON.stringify({name:t,about:r}))}editUserAvatar(e){return this._fetch("/users/me/avatar","PATCH",JSON.stringify({avatar:e}))}addCard(e){let{name:t,link:r}=e;return this._fetch("/cards","POST",JSON.stringify({name:t,link:r}))}deleteCard(e){return this._fetch(`/cards/${e}`,"DELETE")}changeLike(e,t){return this._fetch(`/cards/${t}/likes`,e?"DELETE":"PUT")}_fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0;return fetch(this._baseUrl+e,{method:t,headers:this._headers,body:r}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"6f5c355c-ba63-4c32-a72d-75121ae25533","Content-Type":"application/json"}});i.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{u.append(N(e))})),v.textContent=r.name,h.textContent=r.about,y.src=r.avatar})).catch(console.error);const s=document.querySelector("#card-template").content,u=document.querySelector(".cards__list"),m=document.querySelector("#edit-profile-modal"),_=document.querySelector(".profile__edit-button"),v=(m.querySelector(".modal__exit-button"),document.querySelector(".profile__name")),h=document.querySelector(".profile__description"),y=document.querySelector(".profile__avatar"),f=document.forms["profile-form"],S=f.querySelector("#input-name"),p=f.querySelector("#input-description"),q=document.querySelector("#add-card-modal"),b=document.querySelector(".profile__add-button"),E=(q.querySelector(".modal__exit-button"),q.querySelector(".modal__save-button")),k=document.forms["add-card-form"],L=k.querySelector("#add-card-input-link"),C=k.querySelector("#add-card-input-name"),g=document.querySelector("#preview-modal"),x=(g.querySelector(".modal__exit-button"),g.querySelector(".modal__image")),A=g.querySelector(".modal__caption"),U=document.querySelector(".profile__avatar-button"),I=document.querySelector("#avatar-modal"),T=(I.querySelector(".modal__exit-button"),document.forms["avatar-form"]),P=T.querySelector("#avatar-input-link"),B=document.querySelector("#delete-modal"),D=document.forms["delete-form"];function $(e){e.classList.add("modal_opened"),document.addEventListener("keydown",O)}function w(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",O)}function N(e){const t=s.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image");r.textContent=e.name,o.src=e.link,o.alt=e.name;const n=t.querySelector(".card__like-button");return e.isLiked&&n.classList.add("card__like-button_liked"),n.addEventListener("click",(t=>{i.changeLike(n.classList.contains("card__like-button_liked"),e._id).then((()=>{n.classList.toggle("card__like-button_liked")})).catch(console.error)})),t.querySelector(".card__delete-button").addEventListener("click",(r=>{$(B),l=t,d=e._id})),o.addEventListener("click",(t=>{$(g),x.src=e.link,x.alt=e.name,A.textContent=e.name})),t}B.querySelector(".modal__exit-button"),B.querySelector("#cancel-button"),B.querySelector("#delete-button"),document.querySelectorAll(".modal__close").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>w(t)))})),D.addEventListener("submit",(e=>{j(e,(()=>i.deleteCard(d).then((e=>{w(B),l.remove()})).catch(console.error)),"Delete","Deleting...")})),U.addEventListener("click",(()=>{$(I)})),T.addEventListener("submit",(e=>{j(e,(()=>i.editUserAvatar(P.value).then((e=>{y.src=e.avatar,w(I)})).catch(console.error)))})),_.addEventListener("click",(()=>{var t,r;$(m),S.value=v.textContent,p.value=h.textContent,t=f,r=e,[S,p].forEach((e=>{o(t,e,r)}))})),f.addEventListener("submit",(e=>{j(e,(()=>i.editUserInfo({name:S.value,about:p.value}).then((e=>{v.textContent=e.name,h.textContent=e.about,w(m)})).catch(console.error)))})),b.addEventListener("click",(()=>{$(q)})),k.addEventListener("submit",(t=>{j(t,(()=>i.addCard({link:L.value,name:C.value}).then((t=>{w(q),u.prepend(N(t)),a(E,e)})).catch(console.error)))})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal")&&w(e.target)}))}));const O=e=>{"Escape"===e.key&&w(document.querySelector(".modal_opened"))};function j(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.preventDefault();const n=e.submitter;n.textContent=o,t().then((()=>{e.target.reset()})).catch(console.error).finally((()=>{n.textContent=r}))}var J;J=e,document.querySelectorAll(J.formSelector).forEach((e=>{((e,r)=>{const o=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);n(o,a,r),o.forEach((c=>{c.addEventListener("input",(()=>{t(e,c,r),n(o,a,r)}))}))})(e,J)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFpQnhILEVBQU9SLGNBQ3pDNEUsU0FBU3RFLElBS004SSxFQUFDOUksRUFBYUUsS0FDdEMsTUFBTWMsRUFBWStILE1BQU1DLEtBQ3RCaEosRUFBWTBILGlCQUFpQnhILEVBQU9QLGdCQUVoQ3NCLEVBQWdCakIsRUFBWVMsY0FBY1AsRUFBT04sc0JBQ3ZEbUIsRUFBa0JDLEVBQVdDLEVBQWVmLEdBRTVDYyxFQUFVc0QsU0FBU3JFLElBQ2pCQSxFQUFhMkcsaUJBQWlCLFNBQVMsS0FDckM3RyxFQUFtQkMsRUFBYUMsRUFBY0MsR0FDOUNhLEVBQWtCQyxFQUFXQyxFQUFlZixFQUFPLEdBQ25ELEdBQ0YsRUFoQkE0SSxDQUFrQjlJLEVBQWFFLEVBQU8sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGNvbmZpZ1NldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAvLyBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKVxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gIGVsc2VcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgY29uZmlnXG4gICAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApLnRleHRDb250ZW50ID1cbiAgICBlcnJvck1lc3NhZ2U7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCkudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoZWxlbWVudCkgPT4gIWVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xufTtcbiIsImltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIGNvbmZpZ1NldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNmY1YzM1NWMtYmE2My00YzMyLWE3MmQtNzUxMjFhZTI1NTMzXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlckluZm9dKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZERhdGEpID0+IHtcbiAgICAgIGNhcmRMaXN0LmFwcGVuZChnZXRDYXJkRWxlbWVudChjYXJkRGF0YSkpO1xuICAgIH0pO1xuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICBwcm9maWxlRGVzYy50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICAgIHByb2ZpbGVJbWFnZS5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQ7XG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vIGVkaXQgcHJvZmlsZSBlbGVtZW50c1xuY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlRXhpdEJ1dHRvbiA9IHByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wicHJvZmlsZS1mb3JtXCJdO1xuY29uc3QgcHJvZmlsTmFtZUlucHV0ID0gcHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIiNpbnB1dC1uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NJbnB1dCA9IHByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXQtZGVzY3JpcHRpb25cIik7XG5cbi8vIGFkZCBjYXJkIGVsZW1lbnRzXG5jb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xuY29uc3QgYWRkQ2FyZE9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkRXhpdEJ1dHRvbiA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGFkZENhcmRTdWJtaXRCdXR0b24gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiYWRkLWNhcmQtZm9ybVwiXTtcbmNvbnN0IGFkZENhcmRGb3JtTGluayA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtaW5wdXQtbGlua1wiKTtcbmNvbnN0IGFkZENhcmRGb3JtTmFtZSA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtaW5wdXQtbmFtZVwiKTtcblxuLy8gaW1hZ2UgcHJldmlldyBlbGVtZW50c1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0V4aXRCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZXhpdC1idXR0b25cIik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBhdmF0YXIgZWxlbWVudHNcbmNvbnN0IGF2YXRhck9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyQ2xvc2VCdXR0b24gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImF2YXRhci1mb3JtXCJdO1xuY29uc3QgYXZhdGFyRm9ybUxpbmsgPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWlucHV0LWxpbmtcIik7XG5cbi8vIGRlbGV0ZSBlbGVtZW50c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImRlbGV0ZS1mb3JtXCJdO1xuY29uc3QgZGVsZXRlQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNhbmNlbEJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FuY2VsLWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNvbmZpcm1CdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1idXR0b25cIik7XG5cbi8vIGNsb3NlIGJ1dHRvbiBhc3NpZ25tZW50XG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZVwiKTtcbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgY29uc3QgcG9wdXAgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKHBvcHVwKSk7XG59KTtcblxuLy8gZGVsZXRlIGV2ZW50c1xuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgaGFuZGxlRm9ybVN1Ym1pdChcbiAgICBldnQsXG4gICAgKCkgPT4ge1xuICAgICAgcmV0dXJuIGFwaVxuICAgICAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgIH0sXG4gICAgXCJEZWxldGVcIixcbiAgICBcIkRlbGV0aW5nLi4uXCJcbiAgKTtcbn0pO1xuXG4vLyBhdmF0YXIgZXZlbnRzXG5hdmF0YXJPcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZUZvcm1TdWJtaXQoZXZ0LCAoKSA9PiB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmVkaXRVc2VyQXZhdGFyKGF2YXRhckZvcm1MaW5rLnZhbHVlKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgcHJvZmlsZUltYWdlLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH0pO1xufSk7XG5cbi8vIGVkaXQgcHJvZmlsZSBldmVudHNcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChwcm9maWxlTW9kYWwpO1xuICBwcm9maWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgcHJvZmlsZURlc2NJbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oXG4gICAgcHJvZmlsZUZvcm0sXG4gICAgW3Byb2ZpbE5hbWVJbnB1dCwgcHJvZmlsZURlc2NJbnB1dF0sXG4gICAgY29uZmlnU2V0dGluZ3NcbiAgKTtcbn0pO1xucHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZUZvcm1TdWJtaXQoZXZ0LCAoKSA9PiB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICAgIG5hbWU6IHByb2ZpbE5hbWVJbnB1dC52YWx1ZSxcbiAgICAgICAgYWJvdXQ6IHByb2ZpbGVEZXNjSW5wdXQudmFsdWUsXG4gICAgICB9KVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICAgIHByb2ZpbGVEZXNjLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgICAgY2xvc2VNb2RhbChwcm9maWxlTW9kYWwpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSk7XG59KTtcblxuLy8gYWRkIGNhcmQgZXZlbnRzXG5hZGRDYXJkT3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbn0pO1xuYWRkQ2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZUZvcm1TdWJtaXQoZXZ0LCAoKSA9PiB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmFkZENhcmQoeyBsaW5rOiBhZGRDYXJkRm9ybUxpbmsudmFsdWUsIG5hbWU6IGFkZENhcmRGb3JtTmFtZS52YWx1ZSB9KVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICBjbG9zZU1vZGFsKGFkZENhcmRNb2RhbCk7XG4gICAgICAgIGNhcmRMaXN0LnByZXBlbmQoZ2V0Q2FyZEVsZW1lbnQocmVzKSk7XG4gICAgICAgIGRpc2FibGVCdXR0b24oYWRkQ2FyZFN1Ym1pdEJ1dHRvbiwgY29uZmlnU2V0dGluZ3MpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIG1vZGFsRXNjYXBlTGlzdGVuZXIpO1xufVxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBtb2RhbEVzY2FwZUxpc3RlbmVyKTtcbn1cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGNhcmREYXRhKSB7XG4gIC8vIENyZWF0ZSBDYXJkIEZyb20gVGVtcGxhdGVcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICAvLyBHZXQgY2FyZCBlbGVtZW50c1xuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuXG4gIC8vIEFzc2lnbiBjYXJkIGRhdGFcbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgY2FyZEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuXG4gIC8vIFNldHVwIGJ1dHRvbnNcbiAgY29uc3QgbGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGlmIChjYXJkRGF0YS5pc0xpa2VkKSBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgbGlrZUJ1dHRvbiAvLyBsaWtlIGJ1dHRvblxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgYXBpXG4gICAgICAgIC5jaGFuZ2VMaWtlKFxuICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIiksXG4gICAgICAgICAgY2FyZERhdGEuX2lkXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgfSk7XG4gIGNhcmRFbGVtZW50IC8vIGRlbGV0ZSBidXR0b25cbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgICBzZWxlY3RlZENhcmRJZCA9IGNhcmREYXRhLl9pZDtcbiAgICB9KTtcbiAgY2FyZEltYWdlIC8vIHByZWl2ZXcgaW1hZ2VcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICAgICAgcHJldmlld0ltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gICAgICBwcmV2aWV3SW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcbiAgICAgIHByZXZpZXdDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xuICAgICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmNvbnN0IG1vZGFsRXNjYXBlTGlzdGVuZXIgPSAoZXZ0KSA9PiB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGhhbmRsZUZvcm1TdWJtaXQoXG4gIGV2dCxcbiAgc3VibWl0Q2FsbGJhY2ssXG4gIGRlZnVhbHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRUZXh0ID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc3VibWl0VGV4dC50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICBzdWJtaXRDYWxsYmFjaygpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0VGV4dC50ZXh0Q29udGVudCA9IGRlZnVhbHRUZXh0O1xuICAgIH0pO1xufVxuXG5lbmFibGVWYWxpZGF0aW9uKGNvbmZpZ1NldHRpbmdzKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZldGNoKGAvY2FyZHNgKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9mZXRjaChgL3VzZXJzL21lYCk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZldGNoKFxuICAgICAgYC91c2Vycy9tZWAsXG4gICAgICBcIlBBVENIXCIsXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGVkaXRVc2VyQXZhdGFyKGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLl9mZXRjaChcbiAgICAgIGAvdXNlcnMvbWUvYXZhdGFyYCxcbiAgICAgIFwiUEFUQ0hcIixcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyLFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fZmV0Y2goXG4gICAgICBgL2NhcmRzYCxcbiAgICAgIFwiUE9TVFwiLFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZldGNoKGAvY2FyZHMvJHtjYXJkSWR9YCwgXCJERUxFVEVcIik7XG4gIH1cbiAgY2hhbmdlTGlrZShpc0xpa2VkLCBjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fZmV0Y2goYC9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIpO1xuICB9XG5cbiAgX2ZldGNoKGVuZHBvaW50LCBtZXRob2QgPSBcIkdFVFwiLCBib2R5KSB7XG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBlbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogYm9keSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xuICAgICAgZWxzZSBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImNvbmZpZ1NldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhpZGVJbnB1dEVycm9yIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVycm9yTWVzc2FnZSIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwic29tZSIsImVsZW1lbnQiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImFwaSIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiX2ZldGNoIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJuYW1lIiwiYWJvdXQiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJhZGRDYXJkIiwiX3JlZjMiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUxpa2UiLCJpc0xpa2VkIiwiZW5kcG9pbnQiLCJtZXRob2QiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJib2R5IiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlckluZm8iLCJmb3JFYWNoIiwiY2FyZERhdGEiLCJjYXJkTGlzdCIsImFwcGVuZCIsImdldENhcmRFbGVtZW50IiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzYyIsInByb2ZpbGVJbWFnZSIsInNyYyIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiY2FyZFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwicHJvZmlsZU1vZGFsIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlRm9ybSIsImZvcm1zIiwicHJvZmlsTmFtZUlucHV0IiwicHJvZmlsZURlc2NJbnB1dCIsImFkZENhcmRNb2RhbCIsImFkZENhcmRPcGVuQnV0dG9uIiwiYWRkQ2FyZFN1Ym1pdEJ1dHRvbiIsImFkZENhcmRGb3JtIiwiYWRkQ2FyZEZvcm1MaW5rIiwiYWRkQ2FyZEZvcm1OYW1lIiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlIiwicHJldmlld0NhcHRpb24iLCJhdmF0YXJPcGVuQnV0dG9uIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJGb3JtIiwiYXZhdGFyRm9ybUxpbmsiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJvcGVuTW9kYWwiLCJtb2RhbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJtb2RhbEVzY2FwZUxpc3RlbmVyIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZSIsImNhcmRJbWFnZSIsImFsdCIsImxpa2VCdXR0b24iLCJldnQiLCJjb250YWlucyIsIl9pZCIsInRvZ2dsZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJwb3B1cCIsImNsb3Nlc3QiLCJoYW5kbGVGb3JtU3VibWl0IiwidmFsdWUiLCJkYXRhIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJwcmVwZW5kIiwidGFyZ2V0Iiwia2V5Iiwic3VibWl0Q2FsbGJhY2siLCJkZWZ1YWx0VGV4dCIsImxvYWRpbmdUZXh0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRUZXh0Iiwic3VibWl0dGVyIiwicmVzZXQiLCJmaW5hbGx5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iXSwic291cmNlUm9vdCI6IiJ9