!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_disabled",inputErrorClass:"modal__input_type_error"},t=(e,t,o)=>{t.validity.valid?n(e,t,o):r(e,t,t.validationMessage,o)},r=(e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)},n=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},o=(e,t,r)=>{s(e)?a(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},a=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},s=e=>e.some((e=>!e.validity.valid));let i,c;const l=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}addCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}changeLike(e,t){return fetch(`${this._baseUrl}/cards/${t}/likes`,{method:e?"DELETE":"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"6f5c355c-ba63-4c32-a72d-75121ae25533","Content-Type":"application/json"}});l.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{u.append(M(e))})),v.textContent=r.name,f.textContent=r.about,y.src=r.avatar})).catch(console.error);const d=document.querySelector("#card-template").content,u=document.querySelector(".cards__list"),m=document.querySelector("#edit-profile-modal"),_=document.querySelector(".profile__edit-button"),h=m.querySelector(".modal__exit-button"),v=document.querySelector(".profile__name"),f=document.querySelector(".profile__description"),y=document.querySelector(".profile__avatar"),S=document.forms["profile-form"],b=S.querySelector("#input-name"),p=S.querySelector("#input-description"),k=document.querySelector("#add-card-modal"),E=document.querySelector(".profile__add-button"),q=k.querySelector(".modal__exit-button"),L=k.querySelector(".modal__save-button"),C=document.forms["add-card-form"],g=C.querySelector("#add-card-input-link"),x=C.querySelector("#add-card-input-name"),$=document.querySelector("#preview-modal"),U=$.querySelector(".modal__exit-button"),j=$.querySelector(".modal__image"),P=$.querySelector(".modal__caption"),A=document.querySelector(".profile__avatar-button"),I=document.querySelector("#avatar-modal"),D=I.querySelector(".modal__exit-button"),T=document.forms["avatar-form"],B=T.querySelector("#avatar-input-link"),w=document.querySelector("#delete-modal"),N=w.querySelector(".modal__exit-button"),O=w.querySelector("#cancel-button"),J=w.querySelector("#delete-button");function H(e){e.classList.add("modal_opened"),document.addEventListener("keydown",F)}function z(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",F)}function M(e){const t=d.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image");r.textContent=e.name,n.src=e.link,n.alt=e.name;const o=t.querySelector(".card__like-button");return e.isLiked&&o.classList.add("card__like-button_liked"),o.addEventListener("click",(t=>{l.changeLike(o.classList.contains("card__like-button_liked"),e._id).then((()=>{o.classList.toggle("card__like-button_liked")})).catch(console.error)})),t.querySelector(".card__delete-button").addEventListener("click",(r=>{H(w),i=t,c=e._id})),n.addEventListener("click",(t=>{H($),j.src=e.link,j.alt=e.name,P.textContent=e.name})),t}N.addEventListener("click",(()=>{z(w)})),O.addEventListener("click",(()=>{z(w)})),J.addEventListener("click",(()=>{J.textContent="Deleting...",l.deleteCard(c).then((e=>{z(w),i.remove()})).catch(console.error).finally((()=>J.textContent="Delete"))})),A.addEventListener("click",(()=>{H(I)})),D.addEventListener("click",(()=>{z(I)})),T.addEventListener("submit",(e=>{e.preventDefault(),e.submitter.textContent="Saving...",l.editUserAvatar(B.value).then((e=>{y.src=e.avatar,z(I)})).catch(console.error).finally((()=>e.submitter.textContent="Save"))})),_.addEventListener("click",(()=>{var t,r;H(m),b.value=v.textContent,p.value=f.textContent,t=S,r=e,[b,p].forEach((e=>{n(t,e,r)}))})),h.addEventListener("click",(()=>{z(m)})),S.addEventListener("submit",(e=>{e.preventDefault(),e.submitter.textContent="Saving...",l.editUserInfo({name:b.value,about:p.value}).then((e=>{v.textContent=e.name,f.textContent=e.about,z(m)})).catch(console.error).finally((()=>{e.submitter.textContent="Save"}))})),E.addEventListener("click",(()=>{H(k)})),q.addEventListener("click",(()=>{z(k)})),C.addEventListener("submit",(t=>{t.preventDefault(),t.submitter.textContent="Saving...",l.addCard({link:g.value,name:x.value}).then((r=>{z(k),u.prepend(M(r)),t.target.reset(),a(L,e)})).catch(console.error).finally((()=>{t.submitter.textContent="Save"}))})),U.addEventListener("click",(()=>{z($)})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(e=>{e.target.classList.contains("modal")&&z(e.target)}))}));const F=e=>{"Escape"===e.key&&z(document.querySelector(".modal_opened"))};var G;G=e,document.querySelectorAll(G.formSelector).forEach((e=>{((e,r)=>{const n=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);o(n,a,r),n.forEach((s=>{s.addEventListener("input",(()=>{t(e,s,r),o(n,a,r)}))}))})(e,G)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBa0JDLEVBQVdDLEVBQWVmLEVBQU8sR0FDbkQsR0FDRixFQWhCQXFJLENBQWtCdkksRUFBYUUsRUFBTyxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgY29uZmlnU2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc2F2ZS1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc2F2ZS1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIC8vIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpXG4gICk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgZWxzZVxuICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgZm9ybUVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICBjb25maWdcbiAgICApO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCkudGV4dENvbnRlbnQgPVxuICAgIGVycm9yTWVzc2FnZTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKS50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufTtcbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChlbGVtZW50KSA9PiAhZWxlbWVudC52YWxpZGl0eS52YWxpZCk7XG59O1xuIiwiaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgY29uZmlnU2V0dGluZ3MsXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgZGlzYWJsZUJ1dHRvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5sZXQgc2VsZWN0ZWRDYXJkO1xubGV0IHNlbGVjdGVkQ2FyZElkO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI2ZjVjMzU1Yy1iYTYzLTRjMzItYTcyZC03NTEyMWFlMjU1MzNcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VySW5mb10pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkRGF0YSkgPT4ge1xuICAgICAgY2FyZExpc3QuYXBwZW5kKGdldENhcmRFbGVtZW50KGNhcmREYXRhKSk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjLnRleHRDb250ZW50ID0gdXNlckluZm8uYWJvdXQ7XG4gICAgcHJvZmlsZUltYWdlLnNyYyA9IHVzZXJJbmZvLmF2YXRhcjtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudDtcbmNvbnN0IGNhcmRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuLy8gZWRpdCBwcm9maWxlIGVsZW1lbnRzXG5jb25zdCBwcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVFeGl0QnV0dG9uID0gcHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2V4aXQtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJwcm9maWxlLWZvcm1cIl07XG5jb25zdCBwcm9maWxOYW1lSW5wdXQgPSBwcm9maWxlRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0LW5hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY0lucHV0ID0gcHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcIiNpbnB1dC1kZXNjcmlwdGlvblwiKTtcblxuLy8gYWRkIGNhcmQgZWxlbWVudHNcbmNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBhZGRDYXJkT3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGFkZENhcmRFeGl0QnV0dG9uID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2V4aXQtYnV0dG9uXCIpO1xuY29uc3QgYWRkQ2FyZFN1Ym1pdEJ1dHRvbiA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zYXZlLWJ1dHRvblwiKTtcbmNvbnN0IGFkZENhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtY2FyZC1mb3JtXCJdO1xuY29uc3QgYWRkQ2FyZEZvcm1MaW5rID0gYWRkQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1pbnB1dC1saW5rXCIpO1xuY29uc3QgYWRkQ2FyZEZvcm1OYW1lID0gYWRkQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1pbnB1dC1uYW1lXCIpO1xuXG4vLyBpbWFnZSBwcmV2aWV3IGVsZW1lbnRzXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3RXhpdEJ1dHRvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByZXZpZXdJbWFnZSA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXB0aW9uID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbi8vIGF2YXRhciBlbGVtZW50c1xuY29uc3QgYXZhdGFyT3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiKTtcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2V4aXQtYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiYXZhdGFyLWZvcm1cIl07XG5jb25zdCBhdmF0YXJGb3JtTGluayA9IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItaW5wdXQtbGlua1wiKTtcblxuLy8gZGVsZXRlIGVsZW1lbnRzXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19leGl0LWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNhbmNlbEJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FuY2VsLWJ1dHRvblwiKTtcbmNvbnN0IGRlbGV0ZUNvbmZpcm1CdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1idXR0b25cIik7XG5cbi8vIGRlbGV0ZSBldmVudHNcbmRlbGV0ZUNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5kZWxldGVDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcbmRlbGV0ZUNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZGVsZXRlQ29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcbiAgYXBpXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiAoZGVsZXRlQ29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRlXCIpKTtcbn0pO1xuXG4vLyBhdmF0YXIgZXZlbnRzXG5hdmF0YXJPcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcbmF2YXRhckNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgZXZ0LnN1Ym1pdHRlci50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGFwaVxuICAgIC5lZGl0VXNlckF2YXRhcihhdmF0YXJGb3JtTGluay52YWx1ZSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUltYWdlLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiAoZXZ0LnN1Ym1pdHRlci50ZXh0Q29udGVudCA9IFwiU2F2ZVwiKSk7XG59KTtcblxuLy8gZWRpdCBwcm9maWxlIGV2ZW50c1xucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKHByb2ZpbGVNb2RhbCk7XG4gIHByb2ZpbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICBwcm9maWxlRGVzY0lucHV0LnZhbHVlID0gcHJvZmlsZURlc2MudGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBwcm9maWxlRm9ybSxcbiAgICBbcHJvZmlsTmFtZUlucHV0LCBwcm9maWxlRGVzY0lucHV0XSxcbiAgICBjb25maWdTZXR0aW5nc1xuICApO1xufSk7XG5wcm9maWxlRXhpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByb2ZpbGVNb2RhbCk7XG59KTtcbnByb2ZpbGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgZXZ0LnN1Ym1pdHRlci50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogcHJvZmlsTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IHByb2ZpbGVEZXNjSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzYy50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKHByb2ZpbGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBldnQuc3VibWl0dGVyLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XG4gICAgfSk7XG59KTtcblxuLy8gYWRkIGNhcmQgZXZlbnRzXG5hZGRDYXJkT3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbn0pO1xuYWRkQ2FyZEV4aXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xufSk7XG5hZGRDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGV2dC5zdWJtaXR0ZXIudGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBhcGlcbiAgICAuYWRkQ2FyZCh7IGxpbms6IGFkZENhcmRGb3JtTGluay52YWx1ZSwgbmFtZTogYWRkQ2FyZEZvcm1OYW1lLnZhbHVlIH0pXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xuICAgICAgY2FyZExpc3QucHJlcGVuZChnZXRDYXJkRWxlbWVudChyZXMpKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oYWRkQ2FyZFN1Ym1pdEJ1dHRvbiwgY29uZmlnU2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZXZ0LnN1Ym1pdHRlci50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH0pO1xufSk7XG5cbi8vIHByZWl2ZXcgZXZlbnRzXG5wcmV2aWV3RXhpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIG1vZGFsRXNjYXBlTGlzdGVuZXIpO1xufVxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBtb2RhbEVzY2FwZUxpc3RlbmVyKTtcbn1cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGNhcmREYXRhKSB7XG4gIC8vIENyZWF0ZSBDYXJkIEZyb20gVGVtcGxhdGVcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICAvLyBHZXQgY2FyZCBlbGVtZW50c1xuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuXG4gIC8vIEFzc2lnbiBjYXJkIGRhdGFcbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgY2FyZEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuXG4gIC8vIFNldHVwIGJ1dHRvbnNcbiAgY29uc3QgbGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGlmIChjYXJkRGF0YS5pc0xpa2VkKSBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgbGlrZUJ1dHRvbiAvLyBsaWtlIGJ1dHRvblxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgYXBpXG4gICAgICAgIC5jaGFuZ2VMaWtlKFxuICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIiksXG4gICAgICAgICAgY2FyZERhdGEuX2lkXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgfSk7XG4gIGNhcmRFbGVtZW50IC8vIGRlbGV0ZSBidXR0b25cbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgICBzZWxlY3RlZENhcmRJZCA9IGNhcmREYXRhLl9pZDtcbiAgICB9KTtcbiAgY2FyZEltYWdlIC8vIHByZWl2ZXcgaW1hZ2VcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICAgICAgcHJldmlld0ltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gICAgICBwcmV2aWV3SW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcbiAgICAgIHByZXZpZXdDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xuICAgICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmNvbnN0IG1vZGFsRXNjYXBlTGlzdGVuZXIgPSAoZXZ0KSA9PiB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKSk7XG4gIH1cbn07XG5cbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnU2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICBlbHNlIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xuICAgICAgZWxzZSBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIGVsc2UgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgZWRpdFVzZXJBdmF0YXIoYXZhdGFyKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIGVsc2UgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIGVsc2UgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xuICAgICAgZWxzZSBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBjaGFuZ2VMaWtlKGlzTGlrZWQsIGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIGVsc2UgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJjb25maWdTZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsInZhbGlkaXR5IiwidmFsaWQiLCJoaWRlSW5wdXRFcnJvciIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvck1lc3NhZ2UiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsInNvbWUiLCJlbGVtZW50Iiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0VXNlckF2YXRhciIsImF2YXRhciIsImFkZENhcmQiLCJfcmVmMyIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwiY2hhbmdlTGlrZSIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJ1c2VySW5mbyIsImZvckVhY2giLCJjYXJkRGF0YSIsImNhcmRMaXN0IiwiYXBwZW5kIiwiZ2V0Q2FyZEVsZW1lbnQiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjIiwicHJvZmlsZUltYWdlIiwic3JjIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJwcm9maWxlTW9kYWwiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVFeGl0QnV0dG9uIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsInByb2ZpbE5hbWVJbnB1dCIsInByb2ZpbGVEZXNjSW5wdXQiLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkT3BlbkJ1dHRvbiIsImFkZENhcmRFeGl0QnV0dG9uIiwiYWRkQ2FyZFN1Ym1pdEJ1dHRvbiIsImFkZENhcmRGb3JtIiwiYWRkQ2FyZEZvcm1MaW5rIiwiYWRkQ2FyZEZvcm1OYW1lIiwicHJldmlld01vZGFsIiwicHJldmlld0V4aXRCdXR0b24iLCJwcmV2aWV3SW1hZ2UiLCJwcmV2aWV3Q2FwdGlvbiIsImF2YXRhck9wZW5CdXR0b24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckNsb3NlQnV0dG9uIiwiYXZhdGFyRm9ybSIsImF2YXRhckZvcm1MaW5rIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVDbG9zZUJ1dHRvbiIsImRlbGV0ZUNhbmNlbEJ1dHRvbiIsImRlbGV0ZUNvbmZpcm1CdXR0b24iLCJvcGVuTW9kYWwiLCJtb2RhbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJtb2RhbEVzY2FwZUxpc3RlbmVyIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZSIsImNhcmRJbWFnZSIsImFsdCIsImxpa2VCdXR0b24iLCJldnQiLCJjb250YWlucyIsIl9pZCIsInRvZ2dsZSIsImZpbmFsbHkiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdHRlciIsInZhbHVlIiwiZGF0YSIsInJlc2V0VmFsaWRhdGlvbiIsImlucHV0IiwicHJlcGVuZCIsInRhcmdldCIsInJlc2V0IiwicXVlcnlTZWxlY3RvckFsbCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIl0sInNvdXJjZVJvb3QiOiIifQ==